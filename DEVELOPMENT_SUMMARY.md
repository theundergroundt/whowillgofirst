# 부울경싸피 lunch sequence 14 확장 프로그램 개발 문서

## 1. 개요

이 문서는 '부울경싸피 lunch sequence 14' Chrome 확장 프로그램의 개발 과정 및 구현된 기능에 대한 요약입니다. 이 확장 프로그램은 싸피 내 4개 반의 매일 바뀌는 점심 순서를 사용자에게 편리하게 알려주고, 특정 반의 순위를 확인하며, 사용자의 반을 달력에 표시하는 기능을 제공합니다.

## 2. 구현된 주요 기능

### 2.1. 점심 순서 달력 (Calendar View)
*   **기능:** 월별 달력 형태로 각 날짜의 1등 반을 표시합니다.
*   **순서 로직:** '2025년 9월 4일'을 기준으로 `['2반', '3반', '4반', '1반']` 순서로 시작하며, 매 업무일마다 첫 번째 반이 마지막으로 이동하는 방식으로 순서가 변경됩니다.
*   **공휴일/주말 제외:** 한국 공휴일(Nager.Date API 사용)과 주말(토/일)은 순서 계산에서 제외됩니다.
*   **탐색:** 이전/다음 달로 이동하여 다른 달의 순서도 확인할 수 있습니다.

### 2.2. 오늘 순위 보기 (Check Today's Rank)
*   **기능:** 팝업 하단에서 1반부터 4반까지의 버튼을 클릭하면, 오늘 해당 반이 몇 번째로 점심을 먹는지 알려줍니다.
*   **UI:** 결과 텍스트는 이모티콘과 함께 표시되며, 글자 크기가 확대되어 가시성이 좋습니다.

### 2.3. 우리반 설정하기 (Set My Class)
*   **기능:** 사용자가 자신의 반을 설정할 수 있습니다. 설정된 반은 브라우저에 저장되어 팝업을 닫아도 유지됩니다.
*   **시각화:** 달력에서 설정된 '우리반'이 1등인 날짜에는 초록색 점선 테두리가 표시되어 쉽게 알아볼 수 있습니다.

### 2.4. 아이콘 배지 (Icon Badge)
*   **기능:** 확장 프로그램 아이콘 위에 오늘 1등인 반의 번호(예: '2')가 녹색 배경의 배지로 표시됩니다.
*   **자동 업데이트:** 매일 자동으로 업데이트되며, 브라우저 시작 시에도 최신 정보로 갱신됩니다.

## 3. 파일별 변경 사항

### 3.1. `manifest.json`
*   **초기 설정:** 확장 프로그램의 기본 정보(이름, 버전, 설명, 팝업, 백그라운드 스크립트) 정의.
*   **권한 추가:**
    *   `"storage"`: 사용자 설정(우리반 정보) 저장을 위해 추가.
    *   `"host_permissions": ["https://date.nager.at/"]`: 공휴일 API 호출을 위해 추가.
    *   `"alarms"`: 아이콘 배지 자동 업데이트를 위한 스케줄링 기능 사용을 위해 추가.

### 3.2. `popup.html`
*   **초기 UI:** 단순한 버튼에서 시작.
*   **달력 UI:** 월별 달력 구조, 이전/다음 달 버튼, 요일 헤더, 날짜 셀 등으로 전면 개편.
*   **오늘 순위 보기 UI:** 반 선택 버튼 목록과 결과 표시 영역 추가.
*   **우리반 설정하기 UI:** 반 선택 버튼 목록 추가.
*   **메인 타이틀:** 최상단에 '부울경싸피 lunch sequence 14' 제목 블록 추가.
*   **스타일링:**
    *   달력 셀, 주말, 공휴일, 오늘 날짜에 대한 시각적 스타일 정의.
    *   반 버튼(classList, myClassSelector)을 녹색 원형 버튼으로 스타일링.
    *   결과 텍스트 및 섹션 제목 글자 크기 확대.
    *   섹션 간 구분선(`hr`) 추가.
    *   이모티콘 잘림 현상 해결을 위한 결과 박스(`rankResult`)의 `height` 및 `line-height` 조정.
    *   '우리반' 날짜에 대한 초록색 점선 테두리(`my-class-day`) 스타일 정의.

### 3.3. `popup.js`
*   **초기 로직:** 단순한 알림창 표시.
*   **달력 로직:**
    *   `baseDate` (`2025-09-04`) 및 `baseOrder` (`['2반', '3반', '4반', '1반']`) 정의.
    *   `fetchHolidays(year)`: Nager.Date API를 통해 공휴일 정보 비동기적으로 가져오기 및 캐싱.
    *   `toYYYYMMDD(date)`: 시간대 문제를 해결한 날짜 문자열 변환 헬퍼 함수.
    *   `isWeekend(date)`: 주말 여부 확인.
    *   `calculateWorkingDays(start, end, holidays)`: 주말/공휴일을 제외한 업무일 수 계산.
    *   `getOrderForDate(date, holidays)`: 특정 날짜의 점심 순서 계산 (첫 번째 반이 마지막으로 이동하는 로직).
    *   `renderCalendar()`: 달력 UI를 동적으로 생성하고, 각 날짜의 1등 반 표시, 공휴일/주말 강조.
*   **오늘 순위 보기 로직:** `updateRankDisplay(selectedClass)` 함수 구현. 클릭된 반의 오늘 순위를 계산하고 이모티콘과 함께 표시.
*   **우리반 설정하기 로직:** `chrome.storage.local`을 사용하여 선택된 반을 저장하고, 달력 렌더링 시 해당 반의 1등 날짜에 `my-class-day` 클래스 추가.
*   **이벤트 리스너:** 월 이동 버튼, 반 선택 버튼에 대한 이벤트 리스너 등록.

### 3.4. `background.js`
*   **초기 설정:** 빈 서비스 워커 스크립트.
*   **아이콘 배지 로직:**
    *   `popup.js`의 핵심 로직(날짜/순서 계산, 공휴일 fetch)을 재사용하여 `updateBadge()` 함수 구현.
    *   `chrome.action.setBadgeText()` 및 `chrome.action.setBadgeBackgroundColor()`를 사용하여 아이콘 배지 업데이트.
    *   `chrome.runtime.onInstalled`, `chrome.runtime.onStartup`, `chrome.alarms.onAlarm` 리스너를 통해 확장 프로그램 설치/시작 시 및 매일 자동으로 배지 업데이트.
    *   `chrome.alarms.create()`를 사용하여 일일 업데이트 알람 설정.

## 4. 확장 프로그램 사용 방법

1.  **파일 준비:** 이 문서에 설명된 모든 파일(`manifest.json`, `popup.html`, `popup.js`, `background.js`)이 하나의 폴더(`lineProject`)에 있는지 확인합니다.
2.  **크롬 확장 프로그램 페이지 열기:** 크롬 브라우저에서 주소창에 `chrome://extensions`를 입력하고 엔터를 누릅니다.
3.  **개발자 모드 활성화:** 페이지 우측 상단의 '개발자 모드' 토글을 켜줍니다.
4.  **압축 해제된 확장 프로그램 로드:** '압축 해제된 확장 프로그램을 로드합니다' 버튼을 클릭합니다.
5.  **폴더 선택:** 파일들이 있는 `lineProject` 폴더를 선택합니다.
6.  **사용:** 크롬 툴바에 확장 프로그램 아이콘이 나타납니다. 아이콘을 클릭하여 팝업을 열고 기능을 사용합니다. 아이콘 자체에도 오늘 1등 반이 배지로 표시됩니다.

## 5. 향후 개선 사항 (선택 사항)
*   **설정 페이지:** `baseDate`나 `baseOrder`를 사용자가 직접 설정할 수 있는 옵션 페이지 추가.
*   **알림 커스터마이징:** 배지 색상, 알림 시간 등을 사용자가 설정할 수 있도록 개선.
*   **UI/UX 개선:** 디자인 요소 추가 및 애니메이션 적용 등 사용자 경험 향상.

이 문서는 확장 프로그램의 현재 상태를 요약하며, 향후 기능 추가 및 유지보수에 도움이 될 것입니다.